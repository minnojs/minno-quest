define("pipScorer/computeD",["jquery"],function(e){function r(){e.extend(this,{dataArray:{},AnalyzedVar:"latency",ErrorVar:"error",condVar:"",cond1VarValues:[],cond2VarValues:[],parcelVar:"",parcelValue:[],fastRT:300,maxFastTrialsRate:.1,minRT:400,maxRT:1e4,maxErrorParcelRate:.4,errorLatency:{use:"latency",penalty:600,useForSTD:!0},postSettings:{}})}return e.extend(r.prototype,{setComputeObject:function(r){e.extend(this,r)},setDataArray:function(){var e=window.piGlobal;this.dataArray=e.current.logs}}),r}),define("pipScorer/msgMan",["underscore"],function(e){function r(){this.messages=e.extend({},a)}var a={MessageDef:[],manyErrors:"There were too many errors made to determine a result.",tooFast:"There were too many fast trials to determine a result.",notEnough:"There were not enough trials to determine a result."};return e.extend(r.prototype,{setMsgObject:function(r){e.extend(this.messages,r)},getScoreMsg:function(r){var a=this.messages.MessageDef;if(!a||!a.length)throw new Error('You must define a "MessageDef" array.');var t=parseFloat(r),n=null,o=null,s="error: msg was not set",c=!1;if(e.each(a,function(e){n=parseFloat(e.cut),o=e.message,n>=t&&!c&&(s=o,c=!0)}),!c){var i=a.length,u=a[i-1];s=u.message}return s},getMessage:function(e){return this.messages[e]}}),r}),define("pipScorer/parcelMng",["underscore"],function(e){function r(e){this.parcelArray=[],this.scoreData={},this.msgMan=e}return e.extend(r.prototype,{Init:function(r){var a=this,t=this.msgMan,n=window.piGlobal,o=n.current.logs;a.parcelArray=[],a.scoreData={},a.msgMan=t;var s=r.AnalyzedVar,c=r.ErrorVar,i=r.parcelVar,u=r.parcelValue,l=r.minRT,g=r.maxRT,h=r.fastRT,p=0,f=0,d=0,v=0,m=parseFloat(r.maxFastTrialsRate);if("undefined"==typeof u||0===u.length){d=0,p=0,f=0,v=0;var y={};y.name="general",y.trialIData=[],e.each(o,function(e){e[s]>=l&&e[s]<=g?(d++,1==e.data[c]&&v++,a.validate(y,e,r)&&p++):e[s]<=h&&f++}),a.checkErrors(d,v,r),a.parcelArray[0]=y}else e.each(u,function(t,n){d=0,p=0,f=0,v=0;var u={};u.name=t,u.trialIData=[],e.each(o,function(e){var n=e.data[i];n==t&&(e[s]>=l&&e[s]<=g?(d++,1==e.data[c]&&v++,a.validate(u,e,r)&&p++):e[s]<=h&&f++)}),a.checkErrors(d,v,r),a.parcelArray[n]=u});f/p>m&&(a.scoreData.errorMessage=this.msgMan.getMessage("tooFast"))},checkErrors:function(e,r,a){var t=a.maxErrorParcelRate;r/e>t&&(this.scoreData.errorMessage=this.msgMan.getMessage("manyErrors"))},validate:function(e,r,a){var t=a.errorLatency,n=a.ErrorVar,o=r.data;return"latency"==t.use?(e.trialIData.push(r),!0):"false"==t.use?"1"==o[n]?!1:(e.trialIData.push(r),!0):"penalty"==t.use?(e.trialIData.push(r),!0):void 0},addPenalty:function(r,a){var t=a.errorLatency,n=this;if("penalty"==t.use){var o=parseFloat(t.penalty),s=a.ErrorVar,c=a.AnalyzedVar,i=a.condVar,u=a.cond1VarValues,l=a.cond2VarValues,g=r.trialIData,h=r.avgCon1,p=r.avgCon2;e.each(g,function(e){var r=e.data,a=r[s],t=r[i],g=n.checkArray(t,u),f=n.checkArray(t,l);"1"==a&&(g?e[c]+=h+o:f&&(e[c]+=p+o))})}},avgAll:function(r){var a=this;e.each(a.parcelArray,function(e){a.avgParcel(e,r)})},avgParcel:function(r,a){var t=this,n=r.trialIData,o=a.condVar,s=a.cond1VarValues,c=a.cond2VarValues,i=a.AnalyzedVar,u=0,l=0,g=0,h=0,p=0,f=0;e.each(n,function(e){var r=e[i],a=e.data;g+=r,f++;var n=a[o],d=t.checkArray(n,s),v=t.checkArray(n,c);d?(h++,u+=r):v&&(p++,l+=r)}),(2>=h||2>=p)&&(t.scoreData.errorMessage=this.msgMan.getMessage("notEnough")),0!==h&&(u/=h),0!==p&&(l/=p),r.avgCon1=u,r.avgCon2=l,r.diff=r.avgCon1-r.avgCon2,0!==f&&(r.avgBoth=g/f),t.addPenalty(r,a)},checkArray:function(e,r){for(var a=0;a<r.length;a++){var t=r[a];if(t==e)return!0}return!1},varianceAll:function(r){var a=this;e.each(a.parcelArray,function(e){a.varianceParcel(e,r)})},varianceParcel:function(r,a){var t=this,n=a.AnalyzedVar,o=r.trialIData,s=a.cond1VarValues,c=a.cond2VarValues,i=a.condVar,u=r.avgBoth,l=0,g=0,h=[],p=[],f=[],d=a.errorLatency,v=d.useForSTD;e.each(o,function(e){var r=e.data,o=e[n],u=a.ErrorVar,l=r[u],g=r[i],f=t.checkArray(g,s),d=t.checkArray(g,c);f?v?h.push(o):"0"==l&&h.push(o):d&&(v?p.push(o):"0"==l&&h.push(o))}),f=h.concat(p),e.each(f,function(e){var r=e;l=r-u,g+=l*l}),r.variance=g/(f.length-1)},scoreAll:function(r){var a=this,t=0;e.each(a.parcelArray,function(e){a.scoreParcel(e,r),t+=e.score});var n=t/a.parcelArray.length;a.scoreData.score=n.toFixed(2)},scoreParcel:function(e){var r=this,a=Math.sqrt(e.variance);0===a?(r.scoreData.errorMessage=this.msgMan.getMessage("notEnough"),e.score=e.diff):e.score=e.diff/a}}),r}),define("pipScorer/Scorer",["jquery","./computeD","./msgMan","./parcelMng"],function(e,r,a,t){function n(){this.computeData=new r,this.msgMan=new a,this.parcelMng=new t(this.msgMan)}return!!window.console||(console={log:e.noop,error:e.noop}),console.log||(console.log=function(){}),e.extend(n.prototype,{addSettings:function(e,r){switch(e){case"compute":this.computeData.setComputeObject(r);break;case"message":this.msgMan.setMsgObject(r);break;default:throw new Error('SCORER:addSettings: unknow "type" '+e)}},computeD:function(){var e=this.computeData,r=this.parcelMng;e.setDataArray(),r.Init(e),r.avgAll(e),r.varianceAll(e),r.scoreAll(e);var a=r.scoreData,t={};return void 0===a.errorMessage||null===a.errorMessage?(t.FBMsg=this.getFBMsg(a.score),t.DScore=a.score):(t.FBMsg=a.errorMessage,t.DScore=""),t},postToServer:function(r,a,t,n){var o=this.computeData.postSettings||{},s=o.url,c={};return t||(t=o.score),n||(n=o.msg),c[t]=r,c[n]=a,e.post(s,JSON.stringify(c))},dynamicPost:function(r){var a=this.computeData.postSettings||{},t=a.url;return e.post(t,JSON.stringify(r))},getFBMsg:function(e){var r=this.msgMan.getScoreMsg(e);return r}}),n}),define("pipScorer",["pipScorer/Scorer"],function(e){return e});
//# sourceMappingURL=Scorer.js.map