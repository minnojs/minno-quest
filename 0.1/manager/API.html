<!DOCTYPE html>
<html lang="en">
	<head>

		<!-- Meta, title, CSS, favicons, etc. -->
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="Bootstrap, a sleek, intuitive, and powerful mobile first front-end framework for faster and easier web development.">
		<meta name="keywords" content="HTML, CSS, JS, JavaScript, framework, bootstrap, front-end, frontend, web development">
		<meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">

		<title>
			
				piManager
			
			&middot; V0.0
		</title>

		
		<!-- Bootstrap core CSS -->
		<link href="../../bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
		<link href="../css/highlight.css" rel="stylesheet">
		<link href="../css/style.css" rel="stylesheet">
		<style type="text/css">
			pre {display:block;overflow-x:auto;padding:0.5em;background:#000;color:#f8f8f8;-webkit-text-size-adjust:none}
			table {padding: 0;}
			table tr {border-top: 1px solid #cccccc;background-color: white;margin: 0;padding: 0;}
			table tr:nth-child(2n) {background-color: #f8f8f8;}
			table tr th {font-weight: bold;border: 1px solid #cccccc;text-align: left;margin: 0;padding: 6px 13px;}
			table tr td {border: 1px solid #cccccc;text-align: left;margin: 0;padding: 6px 13px;}
			table tr th :first-child, table tr td :first-child {margin-top: 0;}
			table tr th :last-child, table tr td :last-child {margin-bottom: 0;}
		</style>
		

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->

		<!-- Favicons -->
		<link rel="apple-touch-icon" href="../apple-touch-icon.png">
		<link rel="icon" href="../favicon.ico">

	</head>

	<body>
		<a id="skippy" class="sr-only sr-only-focusable" href="#content"><div class="container"><span class="skiplink-text">Skip to main content</span></div></a>

		<!-- Docs master nav -->
		<header class="navbar navbar-static-top bs-docs-nav" id="top" role="banner">
			<div class="container">
				<div class="navbar-header">
					<button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a href="../../" class="navbar-brand">Project Implicit</a>
				</div>
				<nav class="collapse navbar-collapse bs-navbar-collapse">
					<ul class="nav navbar-nav">
						<li class="">
							<a href="../basics/overview.html">Basics</a>
						</li>
						<li class="">
							<a href="../quest/overview.html">piQuest</a>
						</li>
						<li class=" active ">
							<a href="../manager/overview.html">piManager</a>
						</li>
						<li>
							<a href="/PIPlayer">piPlayer</a>
						</li>
					</ul>
					<ul class="nav navbar-nav navbar-right">
						<li>
							<form class="navbar-form navbar-left" role="search" method="get" action="http://www.google.com/search">
							  <div class="form-group">
							    <input type="text" class="form-control" placeholder="Search" name="q" size="25" maxlength="255">
							  </div>
							  <button type="submit" class="btn btn-default" value="Google Search">
							    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
							  </button>
							  <input type="hidden" name="sitesearch" value="projectimplicit.github.io" checked />
							</form>
						</li>

						<li><a href="https://github.com/ProjectImplicit/PIquest">Github</a></li>
					</ul>
				</nav>
			</div>
		</header>

		<div id="content" class="bs-docs-header">
			<div class="container">
				
	<h1>API</h1>
	<p>All the little details...</p>

			</div>
		</div>

		<div class="container bs-docs-container">
			<div class="row">
				<div class="col-md-9" role="main">
					
	<ul>
<li><a href="#settings">Settings</a><ul>
<li><a href="#canvas">canvas</a></li>
<li><a href="#injectstyle">injectStyle</a></li>
<li><a href="#onpretask">onPreTask</a></li>
<li><a href="#onend">onEnd</a></li>
<li><a href="#title">title</a></li>
<li><a href="#preloadimages">preloadImages</a></li>
<li><a href="#skip">skip</a></li>
<li><a href="#skin">Skin</a></li>
</ul>
</li>
<li><a href="#tasks">Tasks</a><ul>
<li><a href="#quest">Quest</a></li>
<li><a href="#message">Message</a></li>
<li><a href="#post">Post</a></li>
</ul>
</li>
<li><a href="#inheritance">Inheritance</a></li>
<li><a href="#custom-tasks">Custom tasks</a><ul>
<li><a href="#plugging-in">Plugging in</a></li>
<li><a href="#activator-function">Activator function</a></li>
<li><a href="#custom-task-example">Custom Task Example</a></li>
</ul>
</li>
<li><a href="#project-implicit-build">Project Implicit Build</a></li>
</ul>
<p>The piManager is responsible for managing several piTasks sequentially. It uses the same API used throughout the project implicit tasks.</p>
<h3 id="settings">Settings</h3>
<p>Settings allow you to control the generic way that the player works. Change the settings using the <code>addSettings</code> function. The first argument to the function is always the name of the setting, the second argument is the setting values. In case the setting is an object, subsequent objects will extend each other so that settings may be progressively added.
All the functions within settings are invoked using angular. This means that you have access to any service you like, as well as some specific assets. <a href="https://docs.angularjs.org/api/auto/service/$injector">In order to access the services</a> simply use arguments with the appropriate name. For instance, this is how you would access <code>$rootScope</code>:</p>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onEnd</span>(<span class="hljs-params">$rootScope</span>)</span>{
    $rootScope.$emit(<span class="hljs-string">'end!!'</span>);
}
</code></pre>
<h4 id="canvas">canvas</h4>
<p><code>canvas</code> takes an object that describes the style of the task environment. Each property of the object changes a different style element.</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Changes</th>
</tr>
</thead>
<tbody>
<tr>
<td>background</td>
<td>The overall background color.</td>
</tr>
<tr>
<td>canvasBackground</td>
<td>Default canvas background color.</td>
</tr>
<tr>
<td>fontColor</td>
<td>Default font color.</td>
</tr>
<tr>
<td>fontSize</td>
<td>Default font size.</td>
</tr>
</tbody>
</table>
<pre><code class="lang-js">API.addSettings(<span class="hljs-string">'canvas'</span>, {
    fontSize: <span class="hljs-string">'2em'</span>
});
</code></pre>
<p>In case you need to fine tune the styles even further you can add css rules into the raw HTML. Support for dynamically adding CSS is planned but not yet supported.</p>
<h4 id="injectstyle">injectStyle</h4>
<p>Injects a string of css into the page.</p>
<pre><code class="lang-js">API.addSettings(<span class="hljs-string">'injectStyle'</span>, <span class="hljs-string">'[pi-quest] label {font-size:1.2em; font-weight:normal;}'</span>);
</code></pre>
<h4 id="onpretask">onPreTask</h4>
<p><code>onPreTask</code> is a function to be called before each task is called.</p>
<pre><code class="lang-js">API.addSettings(<span class="hljs-string">'onPreTask'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">currentTask</span>)</span>{
    doSomethingWith(currentTask);
});
</code></pre>
<table>
<thead>
<tr>
<th>Asset</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>currentTask</td>
<td>The current task object</td>
</tr>
<tr>
<td>prevTask</td>
<td>The previous task object (this may be used as a post task action as wellâ€¦)</td>
</tr>
</tbody>
</table>
<h4 id="onend">onEnd</h4>
<p><code>onEnd</code> is a function to be called as soon as the task sequence ends.</p>
<pre><code class="lang-js">API.addSettings(<span class="hljs-string">'onEnd'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-comment">// Do something: for instance, redirect to 'my/url.js'</span>
    location.href = <span class="hljs-string">'my/url.js'</span>;
});
</code></pre>
<table>
<thead>
<tr>
<th>Asset</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>currentTask</td>
<td>The current (last) task object</td>
</tr>
</tbody>
</table>
<h4 id="title">title</h4>
<p><code>title</code> is a string to be used as the page title (the name displayed on the tag).</p>
<pre><code class="lang-js">API.addSettings(<span class="hljs-string">'title'</span>, <span class="hljs-string">'My Manager Title'</span>);
</code></pre>
<h4 id="preloadimages">preloadImages</h4>
<p>Accepts an array of image urls to preload. The manager will <strong>not</strong> wait until all images are loaded, but it will make images displayed later in the manager sequence be displayed significantly faster.</p>
<pre><code class="lang-js">API.addSettings(<span class="hljs-string">'preloadImages'</span>, [<span class="hljs-string">'my/image/url/imageName.png'</span>, <span class="hljs-string">'my/other/url/otherImage.jpg'</span>]);
</code></pre>
<h4 id="skip">skip</h4>
<p>Whether to activate the skip and refresh option. If activated, clicking <code>ctrl r</code> reloads the current task (this feature may not be supported on older browsers), clicking <code>escape</code> and then the right or left arrows skips to the next or previous tasks.</p>
<pre><code class="lang-js">API.addSettings(<span class="hljs-string">'skip'</span>, <span class="hljs-literal">true</span>);
</code></pre>
<h3 id="skin">Skin</h3>
<p>Add a skin to your project. Skins change the way that your tasks look. Currently the only skins that we support are <code>simple</code> and <code>demo</code>.</p>
<pre><code class="lang-js">API.addSettings(<span class="hljs-string">'skin'</span>, <span class="hljs-string">'demo'</span>);
</code></pre>
<h3 id="tasks">Tasks</h3>
<p>The basic unit in piManager is the <strong>task</strong>. The manager currently supports several types of tasks; <code>quest</code>, <code>message</code> and <code>post</code>. You should just cue them into the sequence (you can use mixers to your hearts content as well).</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>Task name.</td>
</tr>
<tr>
<td>type</td>
<td>Type of task (quest/message).</td>
</tr>
<tr>
<td>pre</td>
<td>A function to invoke before the task (may return a promise).</td>
</tr>
<tr>
<td>load</td>
<td>A function to invoke as soon as the task is loaded (may return a promise).</td>
</tr>
<tr>
<td>post</td>
<td>A function to invoke after the task (may return a promise).</td>
</tr>
<tr>
<td>canvas</td>
<td>A canvas object (as defined under <a href="#canvas">settings</a>) to invoke at the beginning of the task and remove </td>
</tr>
<tr>
<td>title</td>
<td>A string to be used as the page title (the name displayed on the tag). It is reset at the end of the task.</td>
</tr>
<tr>
<td>preText</td>
<td>A template to be expanded before the task</td>
</tr>
<tr>
<td>postText</td>
<td>A template to be expanded after the task</td>
</tr>
</tbody>
</table>
<h4 id="quest">Quest</h4>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>script</td>
<td>The actual script object for the quest task.</td>
</tr>
<tr>
<td>scriptUrl</td>
<td>The url for the quest script.</td>
</tr>
</tbody>
</table>
<h4 id="message">Message</h4>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>template</td>
<td>the actual html to display as a string.</td>
</tr>
<tr>
<td>templateUrl</td>
<td>The url for the message html file.</td>
</tr>
<tr>
<td>keys</td>
<td>Controls the proceed key: either a key (i.e. <code>&#39;a&#39;</code>) a keyCode (i.e. <code>65</code>) or an array of such (i.e. <code>[&#39;a&#39;,&#39;b&#39;]</code>).</td>
</tr>
</tbody>
</table>
<h4 id="post">Post</h4>
<table>
<thead>
<tr>
<th>property</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>The url we intend to post to.</td>
</tr>
<tr>
<td>path</td>
<td>A path within the global to the object that you want to send. For example: <code>&quot;iat.feedback&quot;</code> will post the object <code>feedback</code> from <code>global.iat</code>.</td>
</tr>
<tr>
<td>data</td>
<td>A raw object to be posted to the server. You may use templates in order to construct it.</td>
</tr>
</tbody>
</table>
<h3 id="inheritance">Inheritance</h3>
<p>piManager uses the same inheritance system used by piQuest. It has one type of set: the task set. In order to create task sets use <code>addTasksSet(set, list)</code>.</p>
<h3 id="custom-tasks">Custom tasks</h3>
<p>The piManager allows the creation of custom tasks. The format is fairly simple though you probably need at least some experience with programing for it. </p>
<h4 id="plugging-in">Plugging in</h4>
<p>piManager manages the task sequence for you as well as loading the task script (if needed). There are several ways to plug a new task into piManager, the all involve passing the activator function to the manager in various ways.</p>
<ol>
<li>You can pass the activator function as a script.</li>
<li>You can pass it as the play property of the script object ().</li>
<li>You can set it into the <code>taskActivateProvider</code> using <code>taskActivateProvider.set(taskName, activatorFunction)</code> during the configuration stage of the angular flow (This is worth the trouble mainly if you intend to use this task many times).</li>
</ol>
<h4 id="activator-function">Activator function</h4>
<p>The activator function is the function that is responsible for the activation of your task as well as for the communication with piManager.</p>
<p>It should:</p>
<ul>
<li>Run your task (just do whatever you like).</li>
<li>Return a function that may be used to force the end of the task.</li>
<li>Call the <code>done</code> function whenever it is done.</li>
</ul>
<p>The activator function is invoked using <a href="https://docs.angularjs.org/guide/di">angular dependency injection</a>, so you can use any of the angular <a href="https://docs.angularjs.org/guide/di#dependency-annotation">annotation</a> methods to get dependencies.</p>
<p>The following dependencies are supported (as well as all standard angular services):</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>done</td>
<td>A function that lets the manager know that the task has finished.</td>
</tr>
<tr>
<td>props</td>
<td>An object with all sorts of useful tools.</td>
</tr>
<tr>
<td>$scope</td>
<td>The task scope.</td>
</tr>
<tr>
<td>task</td>
<td>The piManager element that defined this task.</td>
</tr>
<tr>
<td>script</td>
<td>The task script (as defined in task.script or loaded from task.scriptUrl).</td>
</tr>
<tr>
<td>$element</td>
<td>The tasks DOM Node wrapped in jqLite or jQuery.</td>
</tr>
<tr>
<td>global</td>
<td>The global object</td>
</tr>
<tr>
<td>$injector</td>
<td>an angularjs injector (it can allow you to $compile or accesses $rootScope)</td>
</tr>
</tbody>
</table>
<h4 id="custom-task-example">Custom Task Example</h4>
<p>The following script will display a messages to the user and proceed to the next task after 5 seconds:</p>
<pre><code class="lang-js"><span class="hljs-comment">// the define wrapper</span>
define(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-comment">// the script object being returned</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-comment">// custom script content</span>
        content: <span class="hljs-string">'Hi there, I\'m your custom message'</span>,

        <span class="hljs-comment">// the activator function uses three dependencie</span>
        play: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">activator</span>(<span class="hljs-params">done, script, $element</span>)</span>{
            <span class="hljs-keyword">var</span> timeoutId = setTimeout(done, <span class="hljs-number">5000</span>);
            $element.html(script.content);

            <span class="hljs-comment">// will be called at the end of the task to clean things up</span>
            <span class="hljs-comment">// (whether the end is forced or triggered by 'done')</span>
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clear</span>(<span class="hljs-params"></span>)</span>{
                clearTimeout(timeoutId);
                $element.empty();           
            };
        }
    };
});
</code></pre>
<p>In order to use it all you have to do is point the task to the correct url:</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> taskElement = {scriptUrl:<span class="hljs-string">'path/to/script'</span>};
</code></pre>
<h3 id="project-implicit-build">Project Implicit Build</h3>
<p>The project implicit build has a feature for integration with mTurk.
All you have to do is add The following code to your project, replacing the <code>&lt;id#&gt;</code> tags with the appropriate data of course.
The player will redirect the users back to mTurk immediately after the final task in the manager (as defined by the <code>last</code> property).
Setting the <code>isProduction</code> property allows you to switch between the development and production urls for mTurk.</p>
<pre><code class="lang-js">API.addGlobal({
    $mTurk: {
        assignmentId:<span class="hljs-string">'&lt;id#&gt;'</span>,
        hitId:<span class="hljs-string">'&lt;id#&gt;'</span>,
        workerId:<span class="hljs-string">'&lt;id#&gt;'</span>,
        isProduction: <span class="hljs-literal">true</span>
    }
});
</code></pre>


				</div>

				<div class="col-md-3" role="complementary">
					<nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">

						

						

						<ul class="nav bs-docs-sidenav">
						

							
							<li class="">
							<li class="">

								<a href="overview.html">Overview</a>
							</li>
						
							
							<li class="">
							<li class="">

								<a href="messages.html">Messages</a>
							</li>
						
							
							<li class="">
							<li class="">

								<a href="post.html">Post</a>
							</li>
						
							
							<li class="">
							<li class="">

								<a href="redirect.html">Redirect</a>
							</li>
						
							<li>
								<a href="javascript:void(0)">Examples</a>
								<ul class="nav">
									
							<li class="">
								<div>
									<a href="weightManagerDocco.html">Weight experiment</a>
									<a href="weightManager.js" download="weightManager.js" title="Download"><span class="glyphicon glyphicon-download"></span></a>
									<a href="weightManagerPlay.html" title="Play"><span class="glyphicon glyphicon-play-circle"></span></a>
								</div>
							</li>
						
									
							<li class="">
								<div>
									<a href="videoManagerDocco.html">Displaying Video</a>
									<a href="videoManager.js" download="videoManager.js" title="Download"><span class="glyphicon glyphicon-download"></span></a>
									<a href="videoManagerPlay.html" title="Play"><span class="glyphicon glyphicon-play-circle"></span></a>
								</div>
							</li>
						
								</ul>
							</li>
							
							<li class="">
							<li class=" active ">

								<a href="../manager/API.html">API</a>
							</li>
						
							
							<li class="">
							<li class="">

								<a href="../manager/managerplayground.html">Playground</a>
							</li>
						
						
						</ul>
						<!-- <a class="back-to-top" href="#top">
							Back to top
						</a> -->
					</nav>
				</div>
			</div>
		</div>

		<!-- Footer
		================================================== -->
		<footer class="bs-docs-footer" role="contentinfo">
			<div class="container">
				<p>Created by Project Implicit for the benefit of all.</p>
				<!-- <p>Code licensed under <a href="https://github.com/twbs/bootstrap/blob/master/LICENSE" target="_blank">MIT</a>, documentation under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.</p> -->
				<ul class="bs-docs-footer-links text-muted">
					<li>Currently v0.0.45</li>
					<li>&middot;</li>
					<li><a href="https://github.com/ProjectImplicit/PIquest">GitHub</a></li>
					<li>&middot;</li>
					<li><a href="https://github.com/ProjectImplicit/PIquest/releases">Releases</a></li>
				</ul>
			</div>
		</footer>

	</body>
</html>